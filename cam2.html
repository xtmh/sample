<!DOCTYPE html>
<!-- saved from url=(0042)https://miku3.net/html5/camera/camera.html -->
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" type="text/css" href="gist.css" />
  <title>Camera2</title>
  <style>
    canvas,
    video {
      border: 1px solid gray;
    }
  </style>
</head>

<body>
  <h1>HTML5カメラ2</h1>
  <video id="camera" width="300" height="200"></video>
  <canvas id="picture" width="300" height="200"></canvas>
  <form>
    <button type="button" id="shutter">シャッター</button>
  </form>
  <script>
    window.onload = () => {
      //window.addEventListener('DOMContentLoaded', function() {
      const video = document.querySelector("#camera");
      const canvas = document.querySelector("#picture");
      const se = document.querySelector('#se');

      /** カメラ設定 */
      const constraints = {
        audio: false,
        video: {
          width: 300,
          height: 200,
          facingMode: "user"   // フロントカメラを利用する
          // facingMode: { exact: "environment" }  // リアカメラを利用する場合
        }
      };

      /**
       * カメラを<video>と同期
       */
      navigator.mediaDevices.getUserMedia(constraints).then((stream) => {
        video.srcObject = stream;
        video.onloadedmetadata = (e) => {
          //video.play();
          video.pause();
        };
      })
        .catch((err) => {
          console.log(err.name + ": " + err.message);
        });

      /**
       * シャッターボタン
       */
      document.querySelector("#shutter").addEventListener("click", () => {
        const ctx = canvas.getContext("2d");

        // 演出的な目的で一度映像を止めてSEを再生する
        video.pause();
        /*
        setTimeout(() => {
          video.play();    // カメラ再開
        }, 500);
        */
        // canvasに画像を貼り付ける
        //ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        ctx.drawImage(video, 0, 0, 200, 300);
        /*
        //
        videoStream.getVideoTracks().forEach((track) => {
          track.stop();
        });
        videoStream.getAudioTracks().forEach((track) => {
          track.stop();
        });
        */
      });
    };
  </script>


  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async="" src="./Camera Test_files/js"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-143297-8');
  </script>
  <hr>
  <script src="https://gist.github.com/xtmh/ab25867f394f34f88fd142d017984ea7.js"></script>
</body>

</html>